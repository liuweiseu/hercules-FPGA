C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Software\Keil\8051\C51\BIN\C51.EXE main.c LARGE OPTIMIZE(7,SPEED) BROWSE DEBUG OBJECTEXTEND PRIN
                    -T(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "CME-M5.h"
   2          #include "BasicDataType.h"
   3          
   4          /*
   5          assign reset_dpi_n=port0o[0];
   6          assign pstart = port0o[1];
   7          assign rstn_mipi = port0o[2];
   8          
   9          assign port0i[3]=packet_finish;
  10          assign port0i[4]=tx_dphy_rdy;
  11          */
  12          
  13          #define reset_dpi_n P0_0
  14          #define pstart P0_1
  15          #define rstn_mipi P0_2
  16          #define rstn_lcd P0_7
  17          #define phone_rst  P0_5
  18          
  19          #define packet_finish P0_3
  20          #define tx_dphy_rdy  P0_4
  21          
  22          #define DSI_PERIPH_X_RESOLUTION           1080
  23          #define DSI_PERIPH_Y_RESOLUTION           2220
  24          
  25          
  26          
  27          /****************************************************************************************/
  28          /****************************************************************************************/
  29          /******************************MIPI HOST CONFIG******************************************/
  30          #define DSI_HOST_NUM_LANES              4
  31          #define DSI_HOST_X_RESOLUTION           1080
  32          #define DSI_HOST_Y_RESOLUTION           2160
  33          #define DSI_HOST_HFP                    10
  34          #define DSI_HOST_HBP                    10
  35          #define DSI_HOST_HSA                    2   //HS=VS
  36          #define DSI_HOST_VBP                    10
  37          #define DSI_HOST_VFP                    20
  38          #define DSI_HOST_VSA                    2    //HS=VS
  39          #define DSI_HOST_VC                     0
  40          #define DSI_HOST_MIPI_RATE             1100    //853      //mipi rate MHZ    
  41          
  42          
  43          
  44          #define DSI_HOST_NONCONTINUOUS_CLK      1
  45          #define DSI_HOST_T_PRE                  100
  46          #define DSI_HOST_T_POST                 33
  47          #define DSI_HOST_TX_GAP                 30
  48          #define DSI_HOST_AUTOINSERT_EOTP        1
  49          #define DSI_HOST_EXTRA_CMDS_AFTER_EOTP  0
  50          #define DSI_HOST_HTX_TO_COUNT           0
  51          #define DSI_HOST_LRX_H_TO_COUNT         0
  52          #define DSI_HOST_BTA_H_TO_COUNT         0
  53          #define DSI_HOST_TWAKEUP                200
  54          #define DSI_HOST_PIXEL_PAYLOAD_SIZE     DSI_HOST_X_RESOLUTION    //
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 2   

  55          #define DSI_HOST_PIXEL_FIFO_SEND_LEVEL  240
  56          #define DSI_HOST_INTERFACE_COLOR_CODING 5   //DPI:0:16bit RGB cfg1 1:16bit RGB cfg2 2:18bit RGB cfg3 //3:1
             -8bit RGB cfg1 4:18bit RGB cfg2 //5:24bit RGB
  57          #define DSI_HOST_PIXEL_FORMAT           3   //Sets the DSI packet type of the pixels 0= RGB 16-bit 1= RGB 18-bit
             - 2= RGB 18-bit loosely packed 3= RGB 24-bit
  58          #define DSI_HOST_VSYNC_POLARITY         1   //Sets polarity of dpi_vsync input, 0 active low, 1 active high
  59          #define DSI_HOST_HSYNC_POLARITY         1   //Sets Polarity of dpi_hsync input, 0 active low, 1 active high
  60          #define DSI_HOST_VIDEO_MODE             0   //0=Non-Burst mode with Sync Pulses,1=Non-Burst mode with Sync Events
             -,2=Burst mode
  61          
  62          #define DSI_HOST_ENABLE_MULT_PKTS       0
  63          
  64          #define DSI_HOST_BLLP_MODE              1   //0=blanking packets are sent during BLLP periods,1=LP mode is used fo
             -r BLLP periods    
  65          #define DSI_HOST_USE_NULL_PKT_BLLP      0   //0=Blanking packet used in bllp region,1=Null packet used in bllp
             - region
  66          #define DSI_HOST_VACTIVE                DSI_HOST_Y_RESOLUTION             //
  67          
  68          #define DSI_HOST_DPHY_HS_DATA_PRE       1
  69          #define DSI_HOST_DPHY_HS_CLOCK_PRE      0
  70          #define DSI_HOST_DPHY_HS_DATA_ZERO      25
  71          #define DSI_HOST_DPHY_HS_CLOCK_ZERO     60
  72          #define DSI_HOST_DPHY_HS_CLOCK_TRAIL    13
  73          #define DSI_HOST_DPHY_HS_CLOCK_TRAIL    13
  74          
  75          #define OSC          80                  //FPGA??OSC,??80MHZ
  76          /*******************************************************************************/
  77          /*******************************************************************************/
  78          /******************************MIPI PERIPHERAL CONFIG***************************/
  79          #define DSI_PERIPHERAL_NUM_LANES                              4
  80          #define DSI_PERIPHERAL_VC                                     0
  81          #define DSI_PERIPHERAL_DISABLE_VC_CHECK                       0
  82          #define DSI_PERIPHERAL_REPRESSED_AFTER_UNRECOVER_ECC_ERR      0
  83          #define DSI_PERIPHERAL_HRX_TO_COUNT                           0
  84          #define DSI_PERIPHERAL_LTX_P_TO_COUNT                         0
  85          #define DSI_PERIPHERAL_BTA_P_TO_COUNT                         0
  86          #define DSI_PERIPHERAL_CRC_ERR_ASSERTS_INVALID_TX_LENGTH_ERR  0
  87          #define DSI_PERIPHERAL_ALLOW_READBACK_AFTER_MISSING_BTA_ERR   0
  88          #define DSI_PERIPHERAL_DISABLE_RLPDT_CRC                      0
  89          #define DSI_PERIPHERAL_DISABLE_EOTP                           0
  90          #define DSI_PERIPHERAL_ENABLE_AUTOCLEAR_STATUS_REG            1
  91          #define DSI_PERIPHERAL_THS_SETTLE                             7
  92          #define DSI_PERIPHERAL_TCLK_SETTLE                            16
  93          /*******************************************************************************/
  94          
  95          U8 cfg_data0[  2]  = {0xB0,0x00};
  96          U8 cfg_data1[  4]  = {0xB3,0x00,0x00,0x06};
  97          U8 cfg_data2[  2]  = {0xB4,0x00};
  98          U8 cfg_data3[  6]  = {0xB6,0x33,0xDB,0x80,0x02,0x00};
  99          U8 cfg_data4[  8]  = {0xB8,0x57,0x3D,0x19,0x1E,0x0A,0x50,0x50};
 100          U8 cfg_data5[  8]  = {0xB9,0x6F,0x3D,0x28,0x3C,0x14,0xC8,0xC8};
 101          U8 cfg_data6[  8]  = {0xBA,0xB5,0x33,0x41,0x64,0x23,0xA0,0xA0};
 102          U8 cfg_data7[  3]  = {0xBB,0x14,0x14};
 103          U8 cfg_data8[  3]  = {0xBC,0x37,0x32};
 104          U8 cfg_data9[  3]  = {0xBD,0x64,0x32};
 105          U8 cfg_data10[ 2]  = {0xBE,0x04};
 106          
 107          /************************************************************/
 108          U8 cfg_data_2a[5]  = {0x2A,0x00,0x00,0x04,0x37}; 
 109          U8 cfg_data_2b[5]  = {0x2B,0x00,0x00,0x08,0x6F};
 110          U8 cmd05_cfg_0x11[2]={0x11,0x00};
 111          U8 cmd05_cfg_0x29[2]={0x29,0x00};
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 3   

 112          /************************************************************/
 113          
 114          
 115          
 116          
 117          
 118          
 119          
 120          //8051 to tx mipi apb
 121          U32 xdata host_num_lanes  _at_ 0x8000;
 122          U32 xdata host_noctn_clk  _at_ 0x8004;
 123          U32 xdata host_t_pre    _at_ 0x8008;
 124          U32 xdata host_t_post   _at_ 0x800c;
 125          U32 xdata host_tx_gap   _at_ 0x8010;
 126          U32 xdata host_auto_eotp  _at_ 0x8014;
 127          U32 xdata host_ext_cmd    _at_ 0x8018;
 128          U32 xdata host_hstx_timer _at_ 0x801c;
 129          U32 xdata host_lpdt_timer _at_ 0x8020;
 130          U32 xdata host_bta_timer  _at_ 0x8024;
 131          U32 xdata host_twakeup    _at_ 0x8028;
 132          U32 xdata host_status_ro  _at_ 0x802c;
 133          U32 xdata host_error_ro   _at_ 0x8030;
 134          U32 xdata host_line_size  _at_ 0x8200;
 135          U32 xdata host_fifo_level _at_ 0x8204;
 136          U32 xdata host_color_code _at_ 0x8208;
 137          U32 xdata host_rbg_fmt    _at_ 0x820c;
 138          U32 xdata host_vs_pol   _at_ 0x8210;
 139          U32 xdata host_hs_pol   _at_ 0x8214;
 140          U32 xdata host_video_mode _at_ 0x8218;
 141          U32 xdata host_hfp      _at_ 0x821c;
 142          U32 xdata host_hbp      _at_ 0x8220;
 143          U32 xdata host_hsa      _at_ 0x8224;
 144          U32 xdata host_en_mult_pkts _at_ 0x8228;
 145          U32 xdata host_vbp      _at_ 0x822c;
 146          U32 xdata host_vfp      _at_ 0x8230;
 147          U32 xdata host_bllp_mode  _at_ 0x8234;
 148          U32 xdata host_en_null_pkt  _at_ 0x8238;
 149          U32 xdata host_vactive    _at_ 0x823c;
 150          U32 xdata host_vc     _at_ 0x8240;
 151          U32 xdata host_phy_d_pre  _at_ 0x8300;
 152          U32 xdata host_phy_clk_pre  _at_ 0x8304;
 153          U32 xdata host_phy_d_zero _at_ 0x8308;
 154          U32 xdata host_phy_clk_zero _at_ 0x830c;
 155          U32 xdata host_phy_d_trail  _at_ 0x8310;
 156          U32 xdata host_phy_clk_trail  _at_ 0x8314;
 157          U32 xdata host_pll_cn   _at_ 0x8318;
 158          U32 xdata host_pll_cm   _at_ 0x831c;
 159          U32 xdata host_pll_co   _at_ 0x8320;
 160          
 161          //8051 to rx mipi apb
 162          U32 xdata periph_lanes        _at_ 0x8400;
 163          U32 xdata periph_vc         _at_ 0x8404;
 164          U32 xdata periph_vc_check     _at_ 0x8408;
 165          U32 xdata periph_ecc_err        _at_ 0x840c;
 166          U32 xdata periph_hrx          _at_ 0x8410;
 167          U32 xdata periph_ltx          _at_ 0x8414;
 168          U32 xdata periph_bta          _at_ 0x8418;
 169          U32 xdata periph_crc_err        _at_ 0x841c;
 170          U32 xdata periph_bta_err        _at_ 0x8420;
 171          U32 xdata periph_dis_rlpdt      _at_ 0x8424;
 172          U32 xdata periph_dis_eotp     _at_ 0x8428;
 173          U32 xdata periph_clr_status     _at_ 0x842c;
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 4   

 174          U32 xdata periph_m_settle     _at_ 0x8680;
 175          U32 xdata periph_mc_settle      _at_ 0x8684;
 176          
 177          //extended fp reg  
 178          volatile U8 xdata cmd_fifo      _at_ 0x8800;  
 179          volatile U8 xdata mipi_sel      _at_ 0x8801;
 180          volatile U8 xdata func_set      _at_ 0x8802;
 181          
 182          volatile U8 xdata wd_rdy      _at_ 0x8803;
 183          volatile U8 xdata wd_2a_dats_l      _at_ 0x8804;
 184          volatile U8 xdata wd_2a_dats_h      _at_ 0x8805;
 185          volatile U8 xdata wd_2a_date_l      _at_ 0x8806;
 186          volatile U8 xdata wd_2a_date_h      _at_ 0x8807;
 187          volatile U8 xdata wd_2b_dats_l      _at_ 0x8808;
 188          volatile U8 xdata wd_2b_dats_h      _at_ 0x8809;
 189          volatile U8 xdata wd_2b_date_l      _at_ 0x880a;
 190          volatile U8 xdata wd_2b_date_h      _at_ 0x880b;
 191          volatile U8 xdata busy              _at_ 0x880c;
 192          /****************************ID******************************/
 193          
 194          /************************************************************/
 195          /************************ESD CHECK***************************/
 196          
 197          /***********************************************************/
 198          /************************TX DATA****************************/
 199          
 200          /**********************************************************/
 201          static void mipi_cfg_set( U32 *reg, U32 dat)
 202          { 
 203   1        *reg= dat;
 204   1        return;
 205   1      }
 206          
 207          //static void pinf_cfg_set( U8 *reg, U8 dat)
 208          //{ 
 209          //    *reg= dat;
 210          //    return;
 211          //}
 212          
 213          static void mydelay(U32 delay)
 214          {
 215   1        U32 i;
 216   1        for(i=0;i<delay;i++);
 217   1      }
 218          
 219          static void delay_1ms(U32 delay)
 220          {
 221   1        U32 i,j;
 222   1        for(i=0;i<delay;i++)
 223   1          for(j=0;j<167;j++);
 224   1      }
 225          
 226          static void fiforst(void)
 227          {
 228   1        U8 tmp;
 229   1        tmp=func_set;
 230   1        tmp= tmp&0xfb;
 231   1        func_set = tmp;
 232   1        mydelay(1);
 233   1        tmp= tmp |0x4;
 234   1        func_set=tmp;
 235   1        mydelay(1);
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 5   

 236   1      }
 237          
 238          static void fifowr(void)
 239          {
 240   1        U8 tmp;
 241   1        tmp=func_set;
 242   1        tmp= tmp&0xf7;
 243   1        func_set = tmp;
 244   1        //mydelay(1);
 245   1        tmp= tmp |0x8;
 246   1        func_set=tmp;
 247   1      }
 248          
 249          static void datawr(void)
 250          {
 251   1        U8 tmp;
 252   1        tmp=func_set;
 253   1        tmp= tmp&0xEF;
 254   1        func_set = tmp;
 255   1        //mydelay(1);
 256   1        tmp= tmp |0x10;
 257   1        func_set=tmp;
 258   1      }
 259           
 260          static void hs_enter(U8 flag)
 261          {
 262   1        U8 tmp;
 263   1        tmp=func_set;
 264   1        if(flag)
 265   1        {
 266   2          tmp= tmp|0x2;   
 267   2        }
 268   1        else
 269   1        {
 270   2          tmp= tmp&0xfd;
 271   2        }
 272   1            func_set = tmp;
 273   1      }
 274          void mipi_lp_cmd_send(U8 cmd_set,UINT16 cmd_length , U8 *buf , U8 long_cmd)
 275          {
 276   1        UINT16 u16i,u16j;
 277   1        U8 tmp;
 278   1      //  hs_enter(0);
 279   1        fiforst();
 280   1        //cmd=cmd_set;
 281   1        cmd_fifo=cmd_set;
 282   1        if(long_cmd)
 283   1        {
 284   2            tmp=cmd_length&0xff;
 285   2            //dnum_l=tmp;
 286   2                  cmd_fifo = tmp;
 287   2            tmp=(cmd_length>>8)&0xff;
 288   2            //dnum_h=tmp;
 289   2                  cmd_fifo = tmp;
 290   2                  cmd_fifo = 0x00; //extra 1 byte
 291   2            //datawr();
 292   2          
 293   2            //fiforst();
 294   2            for(u16j=0;u16j<cmd_length;u16j++)
 295   2              {
 296   3                  //dset= *(buf+u16j);
 297   3                              cmd_fifo = *(buf+u16j);
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 6   

 298   3                  //fifowr();
 299   3              }
 300   2                      cmd_fifo = 0x00;
 301   2                      cmd_fifo = 0x00;
 302   2                      cmd_fifo = 0x00;
 303   2                      cmd_fifo = 0x00;
 304   2                //fifowr();
 305   2                //fifowr();
 306   2                //fifowr();
 307   2                //fifowr();
 308   2                
 309   2            pstart=1;
 310   2            while(!packet_finish);
 311   2            pstart=0; 
 312   2                //fiforst();
 313   2        }
 314   1        else
 315   1        {       
 316   2              //dnum_l=*(buf);
 317   2                      cmd_fifo=*(buf);
 318   2              if(cmd_length==2)
 319   2                //dnum_h=*(buf+1);
 320   2                          cmd_fifo=*(buf+1);
 321   2                      cmd_fifo = 0x00;
 322   2                      cmd_fifo = 0x00;
 323   2              //datawr();
 324   2              pstart=1;
 325   2              while(!packet_finish);
 326   2              pstart=0;   
 327   2              //fiforst();
 328   2        }
 329   1      
 330   1       
 331   1      }
*** WARNING C280 IN LINE 276 OF main.c: 'u16i': unreferenced local variable
 332          
 333          void cmd_fill_frame(void)
 334          {
 335   1        UINT16 u16i,u16j;
 336   1        UINT16 len;
 337   1        U8 tmp;
 338   1        U8 flag=0;
 339   1        U8 r,g,b;
 340   1        UINT16 data_len;
 341   1        hs_enter(1);
 342   1        fiforst();
 343   1      
 344   1        
 345   1        data_len = DSI_HOST_X_RESOLUTION*3;
 346   1          len = data_len + 1;
 347   1          for(u16i=0;u16i<DSI_HOST_Y_RESOLUTION;u16i+=1)  //2line
 348   1          {
 349   2              if(u16i<540)
 350   2              {
 351   3                  r=0;
 352   3                  b=0xff;
 353   3                  g=0;
 354   3              }
 355   2              else if(u16i<1080)
 356   2              {
 357   3                  r=0;
 358   3                  b=0;
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 7   

 359   3                  g=0xff;
 360   3              }
 361   2              else if(u16i<1620)
 362   2              {
 363   3                  r=0xff;
 364   3                  b=0xff;
 365   3                  g=0xff;
 366   3              }
 367   2              else
 368   2              {
 369   3                  r=0xff;
 370   3                  b=0;
 371   3                  g=0;
 372   3              }
 373   2          
 374   2              fiforst();
 375   2              cmd_fifo=0x39;
 376   2              tmp=len&0xff;
 377   2              cmd_fifo=tmp;
 378   2              tmp=(len>>8)&0xff;
 379   2              cmd_fifo=tmp;
 380   2              cmd_fifo=0x00;
 381   2      
 382   2              //fiforst();
 383   2              if(flag)
 384   2                  //dset=0x3c;
 385   2                  cmd_fifo=0x3c;
 386   2              else
 387   2              {
 388   3                  //dset=0x2c;
 389   3                  //cmd_fifo=0x2c;
 390   3                  cmd_fifo=0x2c;
 391   3                  flag=1;
 392   3              }
 393   2              //fifowr(); //write cmd
 394   2      
 395   2              for(u16j=0;u16j<data_len;u16j+=3)
 396   2              {
 397   3      
 398   3                  //dset= r;
 399   3                  //fifowr();
 400   3                  //dset= g;
 401   3                  //fifowr();
 402   3                  //dset= b;
 403   3                  //fifowr();
 404   3                if(u16j<1000)
 405   3                {
 406   4                  cmd_fifo = r;
 407   4                  cmd_fifo = g;
 408   4                  cmd_fifo = b;
 409   4                }
 410   3                else if(u16j<2222)
 411   3                {
 412   4                  cmd_fifo = g;
 413   4                  cmd_fifo = b;
 414   4                  cmd_fifo = r;
 415   4                }
 416   3                else 
 417   3                {
 418   4                  cmd_fifo = b;
 419   4                  cmd_fifo = r;
 420   4                  cmd_fifo = g;
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 8   

 421   4                }
 422   3              }
 423   2              cmd_fifo = 0x00;
 424   2              cmd_fifo = 0x00;
 425   2              cmd_fifo = 0x00;
 426   2              cmd_fifo = 0x00;
 427   2              //fifowr();
 428   2              //fifowr();
 429   2              //fifowr();
 430   2              //fifowr();
 431   2      
 432   2              pstart=1;
 433   2              while(!packet_finish);
 434   2              pstart=0;
 435   2              fiforst();
 436   2      
 437   2              //mydelay(1); // 15us delay
 438   2          }
 439   1      }
 440          
 441          
 442          static void panel_init(void)
 443          {
 444   1      /**************************************************/
 445   1          mipi_lp_cmd_send(0x29,  2,cfg_data0 , 1);
 446   1          mipi_lp_cmd_send(0x29,  4,cfg_data1 , 1);
 447   1          mipi_lp_cmd_send(0x29,  2,cfg_data2 , 1);
 448   1          mipi_lp_cmd_send(0x29,  6,cfg_data3 , 1);
 449   1          mipi_lp_cmd_send(0x29,  8,cfg_data4 , 1);
 450   1          mipi_lp_cmd_send(0x29,  8,cfg_data5 , 1);
 451   1          
 452   1      /**********************************************************************************/
 453   1          mipi_lp_cmd_send(0x39,  5,cfg_data_2a , 1);
 454   1          mipi_lp_cmd_send(0x39,  5,cfg_data_2b , 1);
 455   1          mipi_lp_cmd_send(0x05,sizeof(cmd05_cfg_0x11)/sizeof(U8),cmd05_cfg_0x11,0);
 456   1          mipi_lp_cmd_send(0x05,sizeof(cmd05_cfg_0x29)/sizeof(U8),cmd05_cfg_0x29,0);  
 457   1      /********************************************************************************/
 458   1          
 459   1      }
 460          
 461          
 462          /*****************************************************/
 463          static U32 GET_CO_FACTOR(void){
 464   1        
 465   1        U8 co_factor = 0;
 466   1        U8 i;
 467   1        for(i<=0;i<4;i++)
 468   1        {
 469   2          if(((16*OSC)/(3*DSI_HOST_MIPI_RATE))<=TX_PLL_CO[i])
 470   2          {
 471   3            co_factor = i;
 472   3            break;
 473   3          } 
 474   2        }
 475   1        return (U32)co_factor;
 476   1      }
 477          
 478          
 479          static U32 GET_CN_FACTOR(void){
 480   1        return TX_PLL_CN[2];     //CN = 3   ????
 481   1      }
 482          
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 9   

 483          static U32 GET_CM_FACTOR(void){
 484   1        U16 cm_factor;
 485   1        
 486   1        cm_factor = (U16)((3*DSI_HOST_MIPI_RATE*TX_PLL_CO[GET_CO_FACTOR()])/OSC);
 487   1        return TX_PLL_CM[cm_factor-16];
 488   1      }
 489          /****************************************************************/
 490          
 491          /****************************************************************/
 492          void wd_2a_set(U8 dats_h,U8 dats_l,U8 date_h,U8 date_l)
 493          {
 494   1        U16 dat_s,dat_e;
 495   1        dat_s = (((U16)dats_h)<<8)+(U16)dats_l;
 496   1        dat_e = (((U16)date_h)<<8)+(U16)date_l;
 497   1        if((DSI_PERIPH_X_RESOLUTION-DSI_HOST_X_RESOLUTION)==0)
 498   1        {
 499   2          cfg_data_2a[1] = dats_h;
 500   2          cfg_data_2a[2] = dats_l;
 501   2          cfg_data_2a[3] = date_h;
 502   2          cfg_data_2a[4] = date_l;
 503   2        }
 504   1        else if((DSI_PERIPH_X_RESOLUTION-DSI_HOST_X_RESOLUTION)>0)
 505   1        {
 506   2          dat_s = dat_s - dat_s/(DSI_PERIPH_X_RESOLUTION/(DSI_PERIPH_X_RESOLUTION-DSI_HOST_X_RESOLUTION));
*** WARNING C222 IN LINE 506 OF main.c: div by zero
 507   2          dat_e = dat_e - dat_e/(DSI_PERIPH_X_RESOLUTION/(DSI_PERIPH_X_RESOLUTION-DSI_HOST_X_RESOLUTION));
*** WARNING C222 IN LINE 507 OF main.c: div by zero
 508   2          
 509   2          cfg_data_2a[1] = (U8)(dat_s>>8);
 510   2          cfg_data_2a[2] = (U8)dat_s;
 511   2          cfg_data_2a[3] = (U8)(dat_e>>8);
 512   2          cfg_data_2a[4] = (U8)dat_e;
 513   2        }
 514   1        else if((DSI_PERIPH_X_RESOLUTION-DSI_HOST_X_RESOLUTION)<0)
 515   1        {
 516   2          dat_s = dat_s + dat_s/(DSI_HOST_X_RESOLUTION/(DSI_HOST_X_RESOLUTION-DSI_PERIPH_X_RESOLUTION));
*** WARNING C222 IN LINE 516 OF main.c: div by zero
 517   2          dat_e = dat_e + dat_e/(DSI_HOST_X_RESOLUTION/(DSI_HOST_X_RESOLUTION-DSI_PERIPH_X_RESOLUTION));
*** WARNING C222 IN LINE 517 OF main.c: div by zero
 518   2          
 519   2          cfg_data_2a[1] = (U8)(dat_s>>8);
 520   2          cfg_data_2a[2] = (U8)dat_s;
 521   2          cfg_data_2a[3] = (U8)(dat_e>>8);
 522   2          cfg_data_2a[4] = (U8)dat_e;
 523   2        }
 524   1          
 525   1      }
 526          
 527          
 528          
 529          
 530          void wd_2b_set(U8 dats_h,U8 dats_l,U8 date_h,U8 date_l)
 531          {
 532   1        U16 dat_s,dat_e;
 533   1        dat_s = (((U16)dats_h)<<8)+(U16)dats_l;
 534   1        dat_e = (((U16)date_h)<<8)+(U16)date_l;
 535   1        if((DSI_PERIPH_Y_RESOLUTION-DSI_HOST_Y_RESOLUTION)==0)
 536   1        {
 537   2          cfg_data_2b[1] = dats_h;
 538   2          cfg_data_2b[2] = dats_l;
 539   2          cfg_data_2b[3] = date_h;
 540   2          cfg_data_2b[4] = date_l;
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 10  

 541   2        }
 542   1        else if((DSI_PERIPH_Y_RESOLUTION-DSI_HOST_Y_RESOLUTION)>0)
 543   1        {
 544   2          dat_s = dat_s - dat_s/(DSI_PERIPH_Y_RESOLUTION/(DSI_PERIPH_Y_RESOLUTION-DSI_HOST_Y_RESOLUTION));
 545   2          dat_e = dat_e - dat_e/(DSI_PERIPH_Y_RESOLUTION/(DSI_PERIPH_Y_RESOLUTION-DSI_HOST_Y_RESOLUTION));
 546   2          
 547   2          cfg_data_2b[1] = (U8)(dat_s>>8);
 548   2          cfg_data_2b[2] = (U8)dat_s;
 549   2          cfg_data_2b[3] = (U8)(dat_e>>8);
 550   2          cfg_data_2b[4] = (U8)dat_e;
 551   2        }
 552   1        else if((DSI_PERIPH_Y_RESOLUTION-DSI_HOST_Y_RESOLUTION)<0)
 553   1        {
 554   2          dat_s = dat_s + dat_s/(DSI_HOST_Y_RESOLUTION/(DSI_HOST_Y_RESOLUTION-DSI_PERIPH_Y_RESOLUTION));
 555   2          dat_e = dat_e + dat_e/(DSI_HOST_Y_RESOLUTION/(DSI_HOST_Y_RESOLUTION-DSI_PERIPH_Y_RESOLUTION));
 556   2          
 557   2          cfg_data_2b[1] = (U8)(dat_s>>8);
 558   2          cfg_data_2b[2] = (U8)dat_s;
 559   2          cfg_data_2b[3] = (U8)(dat_e>>8);
 560   2          cfg_data_2b[4] = (U8)dat_e;
 561   2        }
 562   1          
 563   1      }
 564          /***************************************************************/
 565          
 566          void main(void)
 567          
 568          { 
 569   1          U32 a;
 570   1          U8 b=0;
 571   1          U8 cmd_d[8];
 572   1          UINT16 u16i;
 573   1          CKCON=0x55;
 574   1          D_PAGESEL= 0x04;
 575   1      
 576   1          busy=0;
 577   1          wd_rdy=0;
 578   1          EAL=1;
 579   1          EX0=0;
 580   1          EX1=0;
 581   1          P1=0;
 582   1          P0_5 = 1;
 583   1          pstart=0;
 584   1          reset_dpi_n=0;
 585   1          rstn_mipi=0;
 586   1          //rstn_lcd=1;
 587   1          rstn_lcd=0;
 588   1          mipi_sel=0; //mipi2
 589   1          mipi_cfg_set( &host_num_lanes       ,DSI_HOST_NUM_LANES-1);
 590   1          mipi_cfg_set( &host_noctn_clk       ,DSI_HOST_NONCONTINUOUS_CLK);
 591   1          mipi_cfg_set( &host_t_pre           ,DSI_HOST_T_PRE);
 592   1          mipi_cfg_set( &host_t_post          ,DSI_HOST_T_POST);
 593   1          mipi_cfg_set( &host_tx_gap          ,DSI_HOST_TX_GAP);
 594   1          mipi_cfg_set( &host_auto_eotp       ,DSI_HOST_AUTOINSERT_EOTP);
 595   1          mipi_cfg_set( &host_ext_cmd         ,DSI_HOST_EXTRA_CMDS_AFTER_EOTP);
 596   1          mipi_cfg_set( &host_hstx_timer      ,DSI_HOST_HTX_TO_COUNT);
 597   1          mipi_cfg_set( &host_lpdt_timer      ,DSI_HOST_LRX_H_TO_COUNT);
 598   1          mipi_cfg_set( &host_bta_timer       ,DSI_HOST_BTA_H_TO_COUNT);
 599   1          mipi_cfg_set( &host_twakeup         ,DSI_HOST_TWAKEUP);
 600   1          mipi_cfg_set( &host_line_size       ,DSI_HOST_PIXEL_PAYLOAD_SIZE);
 601   1          mipi_cfg_set( &host_fifo_level      ,DSI_HOST_PIXEL_FIFO_SEND_LEVEL);
 602   1          mipi_cfg_set( &host_color_code      ,DSI_HOST_INTERFACE_COLOR_CODING);
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 11  

 603   1          mipi_cfg_set( &host_rbg_fmt         ,DSI_HOST_PIXEL_FORMAT);
 604   1          mipi_cfg_set( &host_vs_pol          ,DSI_HOST_VSYNC_POLARITY);
 605   1          mipi_cfg_set( &host_hs_pol          ,DSI_HOST_HSYNC_POLARITY);
 606   1          mipi_cfg_set( &host_video_mode      ,DSI_HOST_VIDEO_MODE);
 607   1          mipi_cfg_set( &host_hfp             ,DSI_HOST_HFP);
 608   1          mipi_cfg_set( &host_hbp             ,DSI_HOST_HBP);
 609   1          mipi_cfg_set( &host_hsa             ,DSI_HOST_HSA);
 610   1          mipi_cfg_set( &host_en_mult_pkts    ,DSI_HOST_ENABLE_MULT_PKTS);
 611   1          mipi_cfg_set( &host_vbp             ,DSI_HOST_VBP);
 612   1          mipi_cfg_set( &host_vfp             ,DSI_HOST_VFP);
 613   1          mipi_cfg_set( &host_bllp_mode       ,DSI_HOST_BLLP_MODE);
 614   1          mipi_cfg_set( &host_en_null_pkt     ,DSI_HOST_USE_NULL_PKT_BLLP);
 615   1          mipi_cfg_set( &host_vactive         ,DSI_HOST_VACTIVE);
 616   1          mipi_cfg_set( &host_vc              ,DSI_HOST_VC);
 617   1          mipi_cfg_set( &host_phy_d_pre       ,DSI_HOST_DPHY_HS_DATA_PRE);
 618   1          mipi_cfg_set( &host_phy_clk_pre     ,DSI_HOST_DPHY_HS_CLOCK_PRE);
 619   1          mipi_cfg_set( &host_phy_d_zero      ,DSI_HOST_DPHY_HS_DATA_ZERO);
 620   1          mipi_cfg_set( &host_phy_clk_zero    ,DSI_HOST_DPHY_HS_CLOCK_ZERO);
 621   1          mipi_cfg_set( &host_phy_d_trail     ,DSI_HOST_DPHY_HS_CLOCK_TRAIL);
 622   1          mipi_cfg_set( &host_phy_clk_trail   ,DSI_HOST_DPHY_HS_CLOCK_TRAIL);
 623   1          mipi_cfg_set( &host_pll_cn          ,GET_CN_FACTOR());
 624   1          mipi_cfg_set( &host_pll_cm          ,GET_CM_FACTOR());
 625   1          mipi_cfg_set( &host_pll_co          ,GET_CO_FACTOR());
 626   1      
 627   1          mipi_sel=1;  //mipi1
 628   1          mipi_cfg_set(  &periph_lanes      ,DSI_PERIPHERAL_NUM_LANES-1   );
 629   1          mipi_cfg_set(  &periph_vc         ,DSI_PERIPHERAL_VC  );
 630   1          mipi_cfg_set(  &periph_vc_check   ,DSI_PERIPHERAL_DISABLE_VC_CHECK  );
 631   1          mipi_cfg_set(  &periph_ecc_err    ,DSI_PERIPHERAL_REPRESSED_AFTER_UNRECOVER_ECC_ERR );
 632   1          mipi_cfg_set(  &periph_hrx        ,DSI_PERIPHERAL_HRX_TO_COUNT  );
 633   1          mipi_cfg_set(  &periph_ltx        ,DSI_PERIPHERAL_LTX_P_TO_COUNT  );
 634   1          mipi_cfg_set(  &periph_bta        ,DSI_PERIPHERAL_BTA_P_TO_COUNT  );
 635   1          mipi_cfg_set(  &periph_crc_err    ,DSI_PERIPHERAL_CRC_ERR_ASSERTS_INVALID_TX_LENGTH_ERR );
 636   1          mipi_cfg_set(  &periph_bta_err    ,DSI_PERIPHERAL_ALLOW_READBACK_AFTER_MISSING_BTA_ERR  );
 637   1          mipi_cfg_set(  &periph_dis_rlpdt  ,DSI_PERIPHERAL_DISABLE_RLPDT_CRC );
 638   1          mipi_cfg_set(  &periph_dis_eotp   ,DSI_PERIPHERAL_DISABLE_EOTP  );
 639   1          mipi_cfg_set(  &periph_clr_status ,DSI_PERIPHERAL_ENABLE_AUTOCLEAR_STATUS_REG );
 640   1          mipi_cfg_set(  &periph_m_settle   ,DSI_PERIPHERAL_THS_SETTLE  );
 641   1          mipi_cfg_set(  &periph_mc_settle  ,DSI_PERIPHERAL_TCLK_SETTLE ); 
 642   1      
 643   1          func_set=1;
 644   1          fiforst();
 645   1          rstn_mipi=1;//mipi dsi controller reset
 646   1          while(!tx_dphy_rdy);//wait mipi pll lock
 647   1          delay_1ms(1);
 648   1          panel_init();
 649   1          delay_1ms(1);
 650   1          hs_enter(0);
 651   1      
 652   1      
 653   1          //cmd_fill_frame();
 654   1          reset_dpi_n=1;  //start to recive vediodata
 655   1          while(1){
 656   2            if(wd_rdy==1)
 657   2            {
 658   3                busy = 1;
 659   3                reset_dpi_n=0;
 660   3                wd_2a_set(wd_2a_dats_h,wd_2a_dats_l,wd_2a_date_h,wd_2a_date_l);
 661   3                wd_2b_set(wd_2b_dats_h,wd_2b_dats_l,wd_2b_date_h,wd_2b_date_l);
 662   3      
 663   3                mydelay(1);
 664   3                mipi_lp_cmd_send(0x39,5,cfg_data_2a,1);
C51 COMPILER V9.60.7.0   MAIN                                                              01/18/2024 23:09:53 PAGE 12  

 665   3                mipi_lp_cmd_send(0x39,5,cfg_data_2b,1);
 666   3                mydelay(1);
 667   3                busy = 0;
 668   3                while(wd_rdy!=0);
 669   3                reset_dpi_n=1;
 670   3            }
 671   2          }
 672   1      
 673   1      }
*** WARNING C280 IN LINE 569 OF main.c: 'a': unreferenced local variable
*** WARNING C280 IN LINE 571 OF main.c: 'cmd_d': unreferenced local variable
*** WARNING C280 IN LINE 572 OF main.c: 'u16i': unreferenced local variable
 674          
 675          
 676          
 677          
 678          
 679          
 680          
 681          
 682          
 683          
 684          
 685          
 686          
 687          
 688          
 689          
 690          
 691          
*** WARNING C294 IN LINE 506 OF main.c: unreachable code
*** WARNING C294 IN LINE 516 OF main.c: unreachable code
*** WARNING C294 IN LINE 537 OF main.c: unreachable code
*** WARNING C294 IN LINE 554 OF main.c: unreachable code


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   2437    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   1167      73
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  12 WARNING(S),  0 ERROR(S)
